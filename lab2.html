<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lab 2: Registration Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: white;
      padding: 20px;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .success {
      color: green;
      font-size: 18px;
      margin-top: 20px;
    }
    .error-background {
      background-color: #ffe6e6;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    textarea {
      width: 300px;
      height: 100px;
    }
  </style>
  <script>
    // Wait until the page loads to hook up all our event stuff
    window.addEventListener("load", function () {
      const form = document.querySelector("form");
      form.addEventListener("submit", validateForm);
      document.getElementById("message").addEventListener("input", updateWordCount);
    });

    // This is where we check all the form stuff when you hit submit
    function validateForm(event) {
      event.preventDefault();
      let errors = [];
      let formContainer = document.getElementById("formContainer");
      formContainer.classList.remove("error-background");
      document.getElementById("errorMessages").innerHTML = "";
      document.getElementById("successMessage").innerText = "";

      // Check if the username is all lowercase letters
      let username = document.getElementById("username").value;
      if (!/^[a-z]+$/.test(username)) {
        errors.push("Username must contain only lowercase letters.");
      }

      // Password needs at least 1 uppercase, 1 lowercase, and 1 number
      let password = document.getElementById("password").value;
      if (!(/[a-z]/.test(password) && /[A-Z]/.test(password) && /[0-9]/.test(password))) {
        errors.push("Password must contain uppercase, lowercase letters, and a digit.");
      }

      // Student ID should be exactly 9 digits
      let studentId = document.getElementById("studentId").value;
      if (!/^[0-9]{9}$/.test(studentId)) {
        errors.push("Student ID must be exactly 9 digits.");
      }

      // Check if semester is valid and year isn't from the future
      let semester = document.getElementById("semester").value;
      let year = document.getElementById("year").value;
      const validSemesters = ["Fall", "Spring", "Summer"];
      let currentYear = new Date().getFullYear();
      let numericYear = year.length === 2 ? parseInt("20" + year) : parseInt(year);
      if (!validSemesters.includes(semester)) {
        errors.push("Semester must be Fall, Spring, or Summer (case-sensitive). ");
      }
      if (isNaN(numericYear) || numericYear > currentYear) {
        errors.push("Year must not be in the future and must be 2 or 4 digits.");
      }

      // If there's anything wrong, show the red background and the error list
      if (errors.length > 0) {
        formContainer.classList.add("error-background");
        let errorList = "<ul class='error'>" + errors.map(e => `<li>${e}</li>`).join("") + "</ul>";
        document.getElementById("errorMessages").innerHTML = errorList;
      } else {
        // Everything looks good!
        document.getElementById("successMessage").innerText = "SUCCESS!";
      }
    }

    // Counts words as you type and disables textarea after 25 words
    function updateWordCount() {
      let textarea = document.getElementById("message");
      let words = textarea.value.trim().split(/\s+/).filter(word => word);
      let wordCount = words.length;
      let wordsLeft = 25 - wordCount;
      document.getElementById("wordCount").innerText = wordsLeft;
      if (wordsLeft <= 0) {
        textarea.disabled = true;
        document.getElementById("wordCount").innerText = 0;
      }
    }
  </script>
</head>
<body>
  <div id="formContainer">
    <form>
      <label>Username:
        <input type="text" id="username" name="username" required>
      </label>
      <label>Password:
        <input type="password" id="password" name="password" required>
      </label>
      <label>Student ID (9 digits):
        <input type="text" id="studentId" name="studentId" required>
      </label>
      <label>Start Semester:
        <input type="text" id="semester" name="semester" required>
      </label>
      <label>Start Year:
        <input type="text" id="year" name="year" required>
      </label>
      <label>Message (max 25 words):
        <textarea id="message" name="message"></textarea>
        <span>Words left: <span id="wordCount">25</span></span>
      </label>
      <input type="submit" id="submitBtn" value="submit">
      <input type="hidden" name="labSection" value="A3">
    </form>
    <div id="errorMessages"></div>
    <div id="successMessage" class="success"></div>
  </div>
</body>
</html>
